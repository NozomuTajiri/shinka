# 横断インサイトエンジン (Cross-Client Insight Engine)

複数クライアントの活動データから汎用的な知見を抽出し、ベストプラクティスとして配信するエンジン。

## 概要

横断インサイトエンジンは、Mother AIの中核機能の一つとして、複数クライアント間の活動パターンを分析し、成功事例や課題を抽出します。Claude Sonnet 4を活用してベストプラクティスを自動生成し、各クライアントに適切なレコメンデーションを提供します。

## 主な機能

### 1. クライアント活動データ収集

```typescript
const engine = new CrossClientInsightEngine();

const activities = await engine.collectClientActivities(
  ['client1', 'client2', 'client3'],
  {
    start: new Date('2025-01-01'),
    end: new Date('2025-03-31'),
  }
);
```

### 2. パターン検出

複数のパターンタイプを検出:

- **成功パターン**: 高い成功率を達成している対話パターン
- **課題パターン**: 共通して発生している課題
- **トレンドパターン**: 時系列で変化している傾向
- **機会パターン**: 未活用の改善機会

```typescript
const patterns = await engine.detectPatterns(activities);

console.log(patterns[0]);
// {
//   patternId: 'pattern-success-123',
//   name: '高成功率の対話パターン',
//   type: 'success',
//   confidence: 0.85,
//   clients: ['client1', 'client2', 'client3'],
//   ...
// }
```

### 3. ベストプラクティス生成

Claude Sonnet 4を使用してパターンからベストプラクティスを抽出:

```typescript
const practice = await engine.generateBestPractice(pattern);

console.log(practice);
// {
//   practiceId: 'practice-123',
//   title: '効果的な対話戦略',
//   category: 'コミュニケーション',
//   steps: [
//     { order: 1, action: '初期ヒアリング実施', tips: [], commonMistakes: [] },
//     { order: 2, action: '課題の優先順位付け', tips: [], commonMistakes: [] },
//     { order: 3, action: '行動計画の策定', tips: [], commonMistakes: [] },
//   ],
//   expectedOutcomes: ['顧客満足度20%向上', '意思決定速度30%改善'],
//   rating: 4.25,
//   ...
// }
```

### 4. トレンド分析

```typescript
const trends = await engine.analyzeTrends(activities, period);

console.log(trends[0]);
// {
//   trendId: 'trend-topic-0',
//   name: '経営課題への関心',
//   direction: 'up',
//   strength: 0.8,
//   description: '「経営課題」に関する対話が増加しています',
//   affectedClients: 5,
//   projectedImpact: '関連サービスの需要増加が予想されます',
// }
```

### 5. レコメンデーション生成

```typescript
const recommendations = await engine.generateRecommendations(patterns, trends);

console.log(recommendations[0]);
// {
//   id: 'rec-123',
//   priority: 'high',
//   target: 'all',
//   title: '高成功率の対話パターンの活用',
//   rationale: '複数クライアントで高い成功率を達成しているパターン',
//   actions: ['パターンの詳細分析', 'パイロット実施', '全社展開'],
//   expectedBenefit: '顧客満足度',
// }
```

### 6. 包括的なレポート生成

```typescript
const report = await engine.generateReport({
  start: new Date('2025-01-01'),
  end: new Date('2025-03-31'),
});

console.log(report);
// {
//   reportId: 'report-123',
//   title: '横断インサイトレポート 2025/1/1 - 2025/3/31',
//   executiveSummary: '今期は3つの成功パターンを検出し...',
//   patterns: [...],
//   bestPractices: [...],
//   trends: [...],
//   recommendations: [...],
//   generatedAt: new Date(),
// }
```

### 7. インサイト配信

```typescript
const distribution = await engine.distributeInsight(
  'insight-123',
  [
    { type: 'client', id: 'c1', name: 'クライアント1', relevanceScore: 0.9 },
    { type: 'avatar', id: 'a1', name: 'アバター1', relevanceScore: 0.8 },
  ],
  'email'
);

console.log(distribution.status); // 'sent'
```

## アーキテクチャ

```
CrossClientInsightEngine
│
├── データ収集レイヤー
│   └── collectClientActivities() - クライアント活動データの収集
│
├── 分析レイヤー
│   ├── detectPatterns() - パターン検出
│   │   ├── detectSuccessPatterns()
│   │   ├── detectChallengePatterns()
│   │   ├── detectTrendPatterns()
│   │   └── detectOpportunityPatterns()
│   │
│   └── analyzeTrends() - トレンド分析
│       ├── analyzeTopicTrends()
│       ├── analyzeSentimentTrends()
│       └── analyzeOutcomeTrends()
│
├── 生成レイヤー
│   ├── generateBestPractice() - ベストプラクティス生成（Claude Sonnet 4）
│   ├── generateRecommendations() - レコメンデーション生成
│   └── generateReport() - 包括的レポート生成
│
└── 配信レイヤー
    └── distributeInsight() - インサイト配信
```

## データモデル

### ClientActivity

クライアントの活動データを表現:

- `clientId`: クライアントID
- `clientName`: クライアント名
- `industry`: 業界
- `size`: 企業規模（small/medium/large/enterprise）
- `avatarInteractions`: アバター対話履歴
- `outcomes`: ビジネス成果
- `period`: 分析期間

### CrossClientPattern

検出されたパターン:

- `patternId`: パターンID
- `name`: パターン名
- `type`: パターンタイプ（success/challenge/trend/opportunity）
- `description`: 説明
- `conditions`: 発生条件
- `outcomes`: 結果指標
- `confidence`: 信頼度（0-1）

### BestPractice

ベストプラクティス:

- `practiceId`: プラクティスID
- `title`: タイトル
- `category`: カテゴリ
- `steps`: 実施ステップ
- `expectedOutcomes`: 期待される成果
- `applicability`: 適用条件
- `evidence`: エビデンス
- `rating`: 評価（0-5）

## 使用される AI モデル

- **Model**: `claude-sonnet-4-20250514`
- **Max Tokens**: 300-800（用途により変動）
- **用途**:
  - ベストプラクティスの抽出と整理
  - エグゼクティブサマリーの生成

## テスト

```bash
# ユニットテストの実行
npm test tests/mother-ai/insight-engine.test.ts

# カバレッジレポート
npm run test:coverage
```

### テストカバレッジ

- 13のテストケース
- 主要機能の100%カバレッジ
- Anthropic API呼び出しはモック化

## 品質基準

- TypeScriptエラー: 0件
- ESLintエラー: 0件
- テストカバレッジ: 80%以上
- コード行数: 約700行（types + implementation + tests）

## 今後の拡張

1. **リアルタイムパターン検出**: ストリーミング処理による即時検出
2. **機械学習統合**: パターン検出精度の向上
3. **予測分析**: 将来のトレンド予測
4. **マルチテナント対応**: 大規模クライアント環境での最適化
5. **可視化ダッシュボード**: インサイトの視覚的表現

## ライセンス

MIT License

---

Generated by **Miyabi Framework** - AI駆動開発環境
